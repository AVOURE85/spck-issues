var __awaiter=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))((function(o,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function l(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var r;e.done?o(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(s,l)}c((n=n.apply(e,r||[])).next())}))},__generator=this&&this.__generator||function(e,r){var t,n,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(a){return function(l){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=r.call(e,s)}catch(e){a=[6,e],n=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};!function(){function e(e){var r=(e=e||"").lastIndexOf("/");return-1!==r?e.slice(r+1):e}bot.commands=[{command:"go <name>:string",help:"Go to a named bookmark in this file."},{command:"mark <name>:string",help:"Create a bookmark in this file."},{command:"del mark <name>:string",help:"Removes a bookmark."},{command:"clear marks",help:"Removes all bookmarks."},{command:"ls marks",help:"List all bookmarks."}],bot.oncomplete=function(r,t){if(0==r.indexOf("go ")||0==r.indexOf("del mark ")){var n=0==r.indexOf("go ")?"go ":"del mark ";return t.storage.getItem("bookmarks").then((function(r){return r?Object.keys(r).map((function(t){var o=r[t];return{command:n+t,help:o.row+1+":"+o.col+" "+e(o.file)}})):null}))}return bot.commands},bot.take=function(e){return/^(go [a-zA-Z]\w*|mark \w+|del mark \w+|clear marks|ls marks)/.test(e.trim())},bot.onmessage=function(r,t){return __awaiter(this,void 0,void 0,(function(){var n,o,a,s,l,c,u,i,m,k;return __generator(this,(function(b){switch(b.label){case 0:return"ls marks"!=(r=r.trim())?[3,2]:[4,t.storage.getItem("bookmarks")];case 1:return n=b.sent()||{},o=Object.keys(n).reduce((function(r,t){var o=n[t];return r+"|"+t+"|"+e(o.file)+"|"+(o.row+1)+"|"+o.col+"|\n"}),"|Name|File|Row|Col|\n|---|---|---|---|\n"),bot.reply(o,0),[2];case 2:if("clear marks"!=r)return[3,7];b.label=3;case 3:return b.trys.push([3,5,,6]),[4,t.storage.setItem("bookmarks",{})];case 4:return b.sent(),bot.reply("Cleared all bookmarks.",1500),[3,6];case 5:return b.sent(),bot.reply("Error occurred in clearing bookmarks.",3e3),[3,6];case 6:return[2];case 7:return(a=r.match(/^mark (\w+)$/))&&a[1]?/^[0-9]/.test(a[1])?(bot.reply("Bookmark name cannot begin with 0-9.",3e3),[2]):[4,t.storage.getItem("bookmarks")]:[3,14];case 8:return m=b.sent()||{},[4,t.editor.getCursorPosition()];case 9:s=b.sent(),l=s.row,c=s.column,m[a[1]]={file:t.currentFile,row:l,col:c},b.label=10;case 10:return b.trys.push([10,12,,13]),[4,t.storage.setItem("bookmarks",m)];case 11:return b.sent(),bot.reply("Marked "+l+":"+c,1500),[3,13];case 12:return b.sent(),bot.reply("Out of storage: delete some bookmarks to make space.",3e3),[3,13];case 13:return[2];case 14:return(u=r.match(/^del mark (\w+)$/))&&u[1]?[4,t.storage.getItem("bookmarks")]:[3,20];case 15:delete(m=b.sent()||{})[u[1]],b.label=16;case 16:return b.trys.push([16,18,,19]),[4,t.storage.setItem("bookmarks",m)];case 17:return b.sent(),bot.reply('Deleted bookmark "'+u[1]+'"',1500),[3,19];case 18:return b.sent(),bot.reply("Out of storage: delete some bookmarks to make space.",3e3),[3,19];case 19:return[2];case 20:return(i=r.match(/^go (\w+)$/))&&i[1]?[4,t.storage.getItem("bookmarks")]:[3,27];case 21:return m=b.sent()||{},(k=m[i[1]])?t.currentFile===k.file?[3,23]:[4,t.files.open(k.file)]:[3,25];case 22:b.sent(),b.label=23;case 23:return[4,t.editor.navigateTo({row:k.row,column:k.col})];case 24:return b.sent(),[3,26];case 25:bot.reply('Bookmark "'+i[1]+'" not found.',3e3),b.label=26;case 26:return[2];case 27:return bot.reply("["+t.name+'] Unknown command: "'+r+'"',2500),[2]}}))}))}}();